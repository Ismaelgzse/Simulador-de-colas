<header class="contentHeader">
  <div class="subMenu">
    <div class="row justify-content-start">
      <div class="col-2">
        <div class="backAndTitle">
          <a class="backButton" routerLink="/home"><i class="fa-solid fa-arrow-left"></i></a>
          <span class="simulationTitle">{{simulationTitle}}</span>
        </div>
      </div>
      <!--
      <div class="d-sm-none d-lg-block col-lg-1  align-self-center">

      </div>
      -->
      <div class="col-sm-4 col-lg-3 align-self-center templateSet ">
        <div class="templateTitle">Plantillas o ejemplos prediseñados</div>
        <button [disabled]="simulating || quickSimulating" class="btn btnTemplate" data-toggle="modal" data-target="#modalNewFolder"
                (click)="openModalCustomTemplate(customTemplate)">
          <i class="fa-solid fa-wand-magic-sparkles"></i>
          Seleccionar una plantilla
        </button>
        <!--
        <select class="form-select templateSelector" aria-label="Default select example">
          <option selected>Selecciona para elegir una plantilla</option>
          <option value="1">Ninguno</option>
          <option value="2">M/M/1/FIFO</option>
          <option value="3">M/M/1/LIFO</option>
          <option value="4">M/M/2/FIFO</option>
          <option value="5">M/M/2/LIFO</option>
        </select>
        -->
      </div>
      <div class="d-sm-none d-lg-block col-lg-2 align-self-center">
      </div>
      <div class="col-sm-4 col-lg-3 align-self-center templateSet">
        <div class="templateTitle">Controles de simulación</div>
        <div class="row">
          <div class="col-4">
            <div class="titleControls">Terminar</div>
            <button class="controlButtons" [disabled]="!simulating || quickSimulating" (click)="stopSimulating()">
              <i class="fa-solid fa-stop"></i>
            </button>
          </div>
          <!--
          <div class="col-4">
            <div class="titleControls">Pausar</div>
            <button class="controlButtons" [disabled]="!simulating">
              <i class="fa-solid fa-pause"></i>
            </button>
          </div>
          -->
          <div class="col-4">
            <div class="titleControls">Iniciar</div>
            <button class="controlButtons" [disabled]="simulating || quickSimulating" (click)="simulate(stopSimulatingConfirmation)">
              <i type="button" class="fa-solid fa-play"></i>
            </button>
          </div>
          <div class="col-4">
            <div class="titleControls">Simulación rápida</div>
            <button class="controlButtons" [disabled]="simulating || quickSimulating" (click)="openModalQuickSimulation(quickSimulation,stopSimulatingConfirmation)"
                    data-toggle="modal" data-target="#modalSimulation">
              <i class="fa-solid fa-forward"></i>
            </button>
          </div>
        </div>
      </div>
      <!--
      <div class="col-1">
        <button type="button" [disabled]="simulating" (click)="openModalQuickSimulation(quickSimulation)"
                class="btn btnForward"
                data-toggle="modal" data-target="#modalSimulation">
          <i class="fa-solid fa-forward"></i>
          Simulación rápida
        </button>
      </div>
      -->
      <div class="col-sm-3 col-lg-2 align-self-end save">
        <button [disabled]="simulating || quickSimulating" class="btn btnReset" data-toggle="modal" data-target="#modalNewFolder"
                (click)="resetPositions()">
          <i class="fa-solid fa-arrows-rotate"></i>
          Reiniciar posiciones
        </button>
      </div>
    </div>
  </div>
</header>

<div class="leftMenuContainer">
  <div class="leftMenu">
    <div class="titleDragItems">Crea tu modelo</div>
    <div class="textDragItems">Arrastra los elementos de modelado al canvas central</div>
    <div class="dragItemContainer">
      <div class="titleDragContainer">Fuente</div>
      <div id="Fuen" class="image" draggable="true">
        <svg width="200" height="100" cursor="grab">
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">Out:
            </text>
          </g>
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#3399ff"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">Fuente
            </text>
          </g>
        </svg>
      </div>
    </div>
    <div class="dragItemContainer">
      <div class="titleDragContainer">Cola</div>
      <div id="Cola" class="image" draggable="true">
        <svg width="200" height="100" cursor="grab">
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">In:
            </text>
          </g>
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="rgb(0, 255, 153)"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">Cola
            </text>
          </g>
        </svg>
      </div>
    </div>
    <div class="dragItemContainer">
      <div class="titleDragContainer">Servidor</div>
      <div id="Proc" class="image" draggable="true">
        <svg width="200" height="100" cursor="grab">
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">Util:
            </text>

          </g>
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ffcc00"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">Servidor
            </text>

          </g>
        </svg>
      </div>
    </div>
    <div class="dragItemContainer">
      <div class="titleDragContainer">Sumidero</div>
      <div id="Sumi" class="image" draggable="true">
        <svg width="200" height="100" cursor="grab">
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">In:
            </text>

          </g>
          <g stroke="black" stroke-width="1px" fill="white">
            <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ff6699"
                  stroke="rgb(0, 0, 0)"
                  stroke-width="2.1"></rect>
            <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                  stroke="none">Sumidero
            </text>

          </g>
        </svg>
      </div>
    </div>
  </div>
</div>
<div *ngIf="blackScreen" class="showScreen leftMenuContainerBlackScreen"></div>


<div id="newConnect" class="alertNewConnection">Nueva conexión
  <i (click)="cancelNewConnection()" type="button" class="fa-solid fa-xmark"></i>
</div>

<div id="cancelConnect" class="alertCancelConnection">
  <span *ngIf="errorConnection===1">No se puede unir a sí mismo, selecciona otro item.</span>
  <span *ngIf="errorConnection===2">Ya existe una conexión entre ambos items.</span>
  <span *ngIf="errorConnection===3">Estructura de simulación no valida. Todos los elementos deben estar conectados entre sí.</span>
</div>

<div id="timer" class="timer">
  <div class="simulatingText">
    <span *ngIf="simulating">Simulando </span>
    <span *ngIf="!simulating">Terminando </span>
    <i class="fas fa-spin fa-circle-notch"></i>
    <div class="timerText">{{timer}}</div>
  </div>
</div>

<div id="waitingExportationData" class="waitingExportModal">
  <div class="quickSimulationText">
    <span *ngIf="stageQuickSimulating===1">Simulando...</span>
    <span *ngIf="stageQuickSimulating===2">Exportando datos...</span>
    <i class="fas fa-spin fa-circle-notch"></i>
  </div>
  <div class="simulatingText">Tiempo restante:</div>
  <div class="quickSimulationText">{{countDownText}}</div>
  <div class="progress" style="width: 70%;margin: 0 auto; margin-top: 50px">
    <div role="progressbar" class="progress-bar progress-bar-striped" [style.width]="percentageCountDownText">
    </div>
  </div>
  <div class="simulatingNote">Nota: No refresque o se vaya de la página, parará el progreso y la exportación de los datos.</div>

</div>


<div id="canvas" class="canvas">
  <div class="blackScreen" id="blackScreen"></div>


  <svg height="100%" width="100%" style="position: absolute;">

    <defs>
      <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto">
        <path d="M0,0 L0,6 L9,3 z" fill="black"/>
      </marker>
    </defs>

    <polyline *ngFor="let connection of listConnections;let i=index"
              [attr.points]="(connection.originItem.positionX+100)+','+(connection.originItem.positionY+75)+','+(connection.originItem.positionX+100)+','+(connection.destinationItem.positionY+75)+','+(connection.destinationItem.positionX+15)+','+(connection.destinationItem.positionY+75)"
              style="stroke:black;fill:transparent;stroke-width: 3" marker-end="url(#arrow)"/>

    <polyline *ngFor="let connection of listConnections;let i=index"
              (click)="openModalDeleteConnection(deleteConnection,connection)"
              [attr.points]="(connection.originItem.positionX+100)+','+(connection.originItem.positionY+75)+','+(connection.originItem.positionX+100)+','+(connection.destinationItem.positionY+75)+','+(connection.destinationItem.positionX+15)+','+(connection.destinationItem.positionY+75)"
              style="stroke:transparent;fill:transparent;stroke-width: 37; cursor: pointer"/>


  </svg>

  <div *ngIf="blackScreen && !simulating">
    <div *ngFor="let itemContainer of listItems; let i=index" id="{{itemContainer.item.name}}"
         style="position: absolute; left:{{itemContainer.item.positionX}}px; top:{{itemContainer.item.positionY}}px"
         (click)="newConnection($event,itemContainer)">
      <svg cursor="pointer"
        *ngIf="itemContainer.item.description==='Sink' && (correctSinkShown || sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">In: {{itemContainer?.sink?.inSink}}
          </text>
          <circle *ngIf="itemContainer.sink!==undefined && itemContainer.sink.inSink>0" r="10" cx="50%" cy="62.5%"
                  fill="white" stroke="black" stroke-width="1"/>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ff6699"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg cursor="pointer"
        *ngIf="itemContainer.item.description==='Source' && (correctSourceSown || sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">Out: {{itemContainer?.source?.outSource}}
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#3399ff"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg cursor="pointer"
        *ngIf="itemContainer.item.description==='Queue' && (correctQueueShown|| sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">In: {{itemContainer?.queue?.inQueue}}
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#00ff99"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg cursor="pointer"
        *ngIf="itemContainer.item.description==='Server' && (correctServerShown || sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="left" text-anchor="left" fill="black"
                stroke="none">Util: {{itemContainer?.server?.pctBusyTime}}
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ffcc00"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>
    </div>
  </div>


  <div *ngIf="blackScreen && simulating">
    <div *ngFor="let itemContainer of simulationService.listItemSimulation; let i=index"
         id="{{itemContainer.item.name}}"
         style="position: absolute; left:{{itemContainer.item.positionX}}px; top:{{itemContainer.item.positionY}}px"
         (click)="newConnection($event,itemContainer)">
      <svg
        *ngIf="itemContainer.item.description==='Sink' && (correctSinkShown || sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">In: {{itemContainer?.sink?.inSink}}
          </text>
          <circle *ngIf="itemContainer.sink!==undefined && itemContainer.sink.inSink>0" r="10" cx="70%" cy="62.5%"
                  fill="white" stroke="black" stroke-width="1"/>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ff6699"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg
        *ngIf="itemContainer.item.description==='Source' && (correctSourceSown || sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">Out: {{itemContainer?.source?.outSource}}
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#3399ff"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg
        *ngIf="itemContainer.item.description==='Queue' && (correctQueueShown|| sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <foreignObject x="27.5" y="29" width="145" height="20">
            <div class="progress" style="width: 98%;margin: 0 auto;">
              <div role="progressbar" [style.width]="progressValue(itemContainer)"
                   [ngClass]="getColor(itemContainer)"></div>
            </div>
          </foreignObject>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">In: {{itemContainer?.queue?.inQueue}}
          </text>
          <circle *ngIf="itemContainer.queue!==undefined && itemContainer.queue.inQueue>0" r="10" cx="70%" cy="62.5%"
                  fill="white" stroke="black" stroke-width="1"/>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#00ff99"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg
        *ngIf="itemContainer.item.description==='Server' && (correctServerShown || sameElement==itemContainer.item.name || simulating)"
        width="200" height="100">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="39%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">Util: {{itemContainer?.server?.pctBusyTime}} %
          </text>
          <circle *ngIf="itemContainer.server!==undefined && itemContainer.server.inServer>0" r="10" cx="70%" cy="62.5%"
                  fill="white" stroke="black" stroke-width="1"/>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ffcc00"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>
    </div>
  </div>

  <div *ngIf="!blackScreen">
    <div *ngFor="let itemContainer of listItems; let i=index" id="{{itemContainer.item.name}}"
         (dragstart)="this.drag($event)" class="images" draggable="true"
         style="position: absolute; left:{{itemContainer.item.positionX}}px; top:{{itemContainer.item.positionY}}px">
      <div id="actionButtons" class="buttons">
        <i class=" actionButton fa-solid fa-arrow-trend-up" type="button" *ngIf="itemContainer.item.description!='Sink'"
           (click)="newConnection($event,itemContainer)"></i>
        <i *ngIf="itemContainer.item.description==='Source'" type='button'
           class='actionButton fa-regular fa-pen-to-square' (click)="openModalEdit(editSource,itemContainer)"></i>
        <i *ngIf="itemContainer.item.description==='Sink'" type='button'
           class='actionButton fa-regular fa-pen-to-square'
           (click)="openModalEdit(editSink,itemContainer)"></i>
        <i *ngIf="itemContainer.item.description==='Server'" type='button'
           class='actionButton fa-regular fa-pen-to-square' (click)="openModalEdit(editServer,itemContainer)"></i>
        <i *ngIf="itemContainer.item.description==='Queue'" type='button'
           class='actionButton fa-regular fa-pen-to-square' (click)="openModalEdit(editQueue,itemContainer)"></i>
        <i type='button' class='actionButton fa-regular fa-trash-can'
           (click)="openModalDeleteItem(deleteItem,itemContainer)"></i>
      </div>

      <svg *ngIf="itemContainer.item.description==='Sink'" width="200" height="100" cursor="all-scroll">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">In:
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ff6699"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg *ngIf="itemContainer.item.description==='Source'" width="200" height="100" cursor="all-scroll">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">Out:
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#3399ff"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg *ngIf="itemContainer.item.description==='Queue'" width="200" height="100" cursor="all-scroll">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">In:
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#00ff99"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

      <svg *ngIf="itemContainer.item.description==='Server'" width="200" height="100" cursor="all-scroll">
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="90" rx="6.93" ry="6.93" fill="rgb(255,255,255)"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="32%" y="65%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">Util:
          </text>
        </g>
        <g stroke="black" stroke-width="1px" fill="white">
          <rect x="27.5px" y="1" width="145" height="36.2" rx="6.93" ry="6.93" fill="#ffcc00"
                stroke="rgb(0, 0, 0)"
                stroke-width="2.1"></rect>
          <text x="50%" y="22.5%" alignment-baseline="middle" text-anchor="middle" fill="black"
                stroke="none">{{itemContainer.item.name}}
          </text>
        </g>
      </svg>

    </div>
  </div>
</div>

<div class="alert alert-secondary loadingAlert" *ngIf="loading">
  <i class="fas fa-spin fa-circle-notch"></i> Cargando...
</div>
<div class="alert alert-warning warningAlert" *ngIf="!loading && (simulationService.listItemSimulation===undefined || simulationService.listItemSimulation.length===0) && simulating">
  <h4 class="alert-heading">Nota importante:</h4>
  Si está viendo esta alerta durante unos segundos, vaya a la consola pulsando F12 y asegúrese que no hay ningún error del tipo: Failed to load resource: <strong>net::ERR_CERT_AUTHORITY_INVALID</strong>.<br>Si es así, sigua los siguientes pasos:<br>
  <strong>1º:</strong> Copie y pegue la url (<strong>https://localhost:8443/ws</strong>) en una pestaña nueva en el navegador.<br>
  <strong>2º</strong> Al hacer eso, se le mostrará una advertencia de que el sitio no es seguro, ignórelo y pulse en el botón de "Avanzado" o "Configuración avanzada".<br>
  <strong>3º</strong> Pinche en continuar en el sitio web.<br>
  <strong>4º</strong> Una vez hecho eso vuelva a la pestaña donde estaba y refresque. Eso le habrá solucionado el error, y podrá cerrar la pestaña que había abierto.<br>
  <br>
  El error que se mostraba es debido a que su navegador detecta que el certificado no está firmado por una entidad confiable, es normal, ya que se trata de un certificado Self signed.
</div>

<button class="controlButtons help" (click)="openHelpModal(helpModal)">
  <i class="fa-regular fa-circle-question fa-4x"></i>
</button>





<div class="modal fade" id="modalNewFolder" tabindex="-1" role="dialog" aria-labelledby="modalSave"
     aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Guarda la simulación</h5>
      </div>
      <div class="modal-body">
        <label for="nameSimulation" class="col-form-label">Nombre<span class="asterisk">*</span></label>
        <input type="text" class="form-control" id="nameSimulation">
        <div class="form-group mt-3">
          <label for="description-simulation" class="col-form-label">Descripción<span
            class="asterisk">*</span></label>
          <textarea class="form-control" id="description-simulation"></textarea>
        </div>
        <div class="form-group mt-3">
          <label for="image" class="col-form-label">Imagen</label>
          <input class="form-control" id="image" name="image" type="file">
          <div class="imageInfo">Esta imagen irá junto con el nombre y la descripción de la simulación, y
            aparecerán en el directorio de simulaciones.
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-danger">Guardar</button>
      </div>
    </div>
  </div>
</div>

<ng-template #stopSimulatingConfirmation let-modal class="modal fade">
  <div class="modal-header">
    <h5>Simulación activa</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    Está activa esta simulación en otra pestaña. Solo se puede tener una simulación ejecutando concurrentemente, si quiere volver a empezar a simular este experimento deberá parar la simulación activa.
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="modal.dismiss()">Cerrar</button>
  </div>
</ng-template>

<ng-template #helpModal let-modal class="modal fade">
  <div class="modal-header">
    <h5>Menú de ayuda</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <p>Esta es la pantalla de simulación donde se podrán construir distintos experimentos sobre la simulación de la
      teoría de colas, a continuación se van a describir las principales posibilidades de esta pantalla.</p>
    <div class="containerHelpMenu">
      <div class="leftContainer">
        <div class="titleHelpMenu">
          - Menú izquierdo:
        </div>
        <p class="textHelpMenu">En este menú se encuentran los distintos tipos de elementos disponibles para la creacion
          de simulaciones personalizadas. Para empezar a crearlas
          solamente deberá arrastrar y soltar un item al lienzo en blanco. Los distintos items disponibles son:</p>
        <div class="subTitleHelpMenu">
          - Fuente o Source:
        </div>
        <p class="subTextHelpMenu">Este tipo de elementos son los encargados de producir o generar los productos.</p>
        <div class="subTitleHelpMenu">
          - Cola o Queue:
        </div>
        <p class="subTextHelpMenu">Este tipo de elementos son los encargados de almacenar los productos que provienen de
          las fuentes o servidores.</p>
        <div class="subTitleHelpMenu">
          - Servidor o Server:
        </div>
        <p class="subTextHelpMenu">Este tipo de elementos son los encargados de procesar los productos que provienen de
          las colas.</p>
        <div class="subTitleHelpMenu">
          - Desagüe o Sink:
        </div>
        <p class="subTextHelpMenu">En este tipo de elementos es donde terminan los productos.</p>
      </div>
      <div class="rightContainer imagesContainer">
        <img class="imageRightContainer" src="assets/png/leftMenu.png">
      </div>
    </div>

    <div class="titleHelpMenu" style="margin-top: 5px;">
      - Menú superior:
    </div>
    <p class="textHelpMenu">En este menú se encuentran los controles de la simulación, la restauración de la
      posición de los elementos de la simulación y el menú de selección de plantillas predefinidas para la
      simulación.</p>

    <div class="containerHelpMenu" style="margin-bottom: 7px;">
      <div class="leftContainer imagesContainer">
        <img class="imageCustomTemplate" src="assets/png/customTemplate.png">
      </div>
      <div class="rightContainer">
        <div class="subTitleHelpMenu">
          - Plantillas o ejemplos prediseñados:
        </div>
        <p class="subTextHelpMenu">Este botón desplegará un diálogo en el que el usuario tendrá la posibilidad de crear
          un sistema de colas prediseñado.</p>
      </div>
    </div>

    <div class="containerHelpMenu" style="margin-bottom: 7px;">
      <div class="leftContainer">
        <div class="subTitleHelpMenu">
          - Controles de la simulación:
        </div>
        <p class="subTextHelpMenu">Estos dos botones tienen la función de terminar y empezar una simulación
          correspondientemente.</p>
      </div>
      <div class="rightContainer imagesContainer">
        <img class="imageCustomTemplate" style="height: 80px;" src="assets/png/simulationControl.png">
      </div>
    </div>

    <div class="containerHelpMenu" style="margin-bottom: 7px;">
      <div class="leftContainer">
        <p class="subTextHelpMenu">Adicionalmente, este otro botón desplegará un diálogo con el que realizar una serie
          de
          experimentos rápidos de un tiempo determinado para la obtención de resultados. Esto permitirá analizar con más
          precisión el estado y viabilidad de un sistema de colas.</p>
      </div>
      <div class="rightContainer imagesContainer">
        <img style="height: 50px;" src="assets/png/quickSimulation.png">
      </div>
    </div>

    <div class="containerHelpMenu" style="margin-bottom: 7px;">
      <div class="leftContainer imagesContainer">
        <img class="imageCustomTemplate" src="assets/png/resetPositions.png">
      </div>
      <div class="rightContainer">
        <div class="subTitleHelpMenu">
          - Botón de reinicio de posiciones:
        </div>
        <p class="subTextHelpMenu">Este botón será el encargado de reiniciar las posiciones de los diferentes elementos
          o items de la simulación. Colocará a estos elementos en unas posiciones concretas a fin de prevenir errores y
          así conseguir que se visualicen todos los elementos correctamente.</p>
      </div>
    </div>

    <div class="titleHelpMenu">
      - Personalización de elementos:
    </div>
    <div class="containerHelpMenu">
      <div class="leftContainer">
        <p class="textHelpMenu">En el lienzo los items tienen la siguiente forma. Tres botones que sirven para la
          creación de una nueva conxión, la edición y el borrado del item, corrrespondientemente. Además, se podrá
          editar
          la posición del item simplemente arrastrando al item al lugar deseado.</p>
      </div>
      <div class="rightContainer imagesContainer">
        <img class="imageRightContainer" style="width: 150px;height: 125px" src="assets/png/item.png">
      </div>
    </div>
    <p class="textHelpMenu">Para añadir una nueva conexión se deberá pinchar primero en el botón con forma de flecha del
      item
      sobre el que se quiere crear el punto de inicio de la conexión. Y luego pinchar sobre el objeto deseado que esté
      resaltado. Siempre que no sea él mismo, o que el objeto ya esté conectado.</p>

    <div class="containerHelpMenu" style="margin-bottom: 7px;">
      <div class="leftContainer">
        <p class="textHelpMenu">Al pulsar el botón de editar un elemento se desplegará un diálogo en el que poder
          personalizarlo. Notar que en este tipo de campos, si se pulsa en el botón con la punta de flecha
          hacia abajo, se desplegarán las posibles opciónes, pero además se podrá personalizar la opción
          seleccionada pinchando en el recuadro que muestra la opción y escribiendo los valores deseados mientras
          cumplan con el formato.
          Si no se tiene claro el formato de la opción selecionado, se podrá consultar dejando el cursor sobre la
          interrogación.</p>
      </div>
      <div class="rightContainer imagesContainer">
        <img style="width: 300px;" src="assets/png/editItem.png">
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="modal.dismiss()">Cerrar</button>
  </div>
</ng-template>

<ng-template #deleteConnection let-modal class="modal fade">
  <div class="modal-header">
    <h5>Eliminar conexión</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <p>¿Deseas borrar esta conexión de todas formas?</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancelar</button>
    <button type="button" class="btn btn-danger" (click)="[modal.dismiss(),deleteConnectionFunction()]">Confirmar
    </button>
  </div>
</ng-template>

<ng-template #customTemplate let-modal class="modal fade">
  <div class="modal-header">
    <h5>Creación de plantilla personalizada</h5>
  </div>
  <form [formGroup]="customTemplateForm" (ngSubmit)="customTemplateFormSubmit()">
    <div class="modal-body">
      <p>En este menú podrás crear un sistema de colas rápidamente.</p>
      <div class="titleHelpMenu">
        - Tiempo entre llegadas:
        <span class="asterisk">*</span>
      </div>

      <div class="containerHelpMenu" style="margin-bottom: 20px;">
        <div class="leftContainer">
          <div class="subTitleHelpMenu">
            Elige el tipo de tiempo entre llegada de los productos.
          </div>
        </div>
        <div class="rightContainer">
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input class="form-control" placeholder="Selecciona el tipo de tiempo entre llegadas"
                   formControlName="interArrivalTimeSourceType">
            <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
            <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
              <div *ngFor="let types of listInterArrivalTypes; let i=index">
                <li ngbDropdownItem>
                  <button class="btnElem" type="button" (click)="setTypeInterArrivalTime(i)">
                    <div>
                      {{types}}
                    </div>
                  </button>
                </li>
                <div *ngIf="i!=listInterArrivalTypes.length-1" class="dropdown-divider"></div>
              </div>
            </ul>
          </div>
        </div>
      </div>

      <div class="imagesContainer">
        <span *ngIf="interArrivalTimeSourceType && interArrivalTimeSourceType.invalid" class="errorMessage">Debe estar seleccionada una opción.</span>
      </div>

      <div *ngIf="typeInterArrivalTime!==-1" class="imagesContainer" style="margin-bottom: 20px;">
        <div class="subTitleHelpMenu">
          Personaliza cada cuanto quieres que lleguen los productos
        </div>
      </div>
      <div *ngIf="typeInterArrivalTime===0" ngbDropdown class="dropdown menuDropdown2 selectMenu imagesContainer">
        <input class="form-control" style="width: 20%" placeholder="Selecciona y personaliza la función"
               formControlName="interArrivalTimeSourceCkeck">
        <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
        <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
          <div *ngFor="let probFunc of listProbDeterministicFunc; let i=index">
            <li ngbDropdownItem>
              <button class="btnElem" type="button" (click)="setInterArrivalTimeSourceCkeck(probFunc)">
                <div>
                  {{probFunc}}
                </div>
              </button>
            </li>
            <div *ngIf="i!=listProbDeterministicFunc.length-1" class="dropdown-divider"></div>
          </div>
        </ul>
      </div>
      <div *ngIf="typeInterArrivalTime===1" ngbDropdown class="dropdown menuDropdown2 selectMenu imagesContainer">
        <input class="form-control" style="width: 20%" placeholder="Selecciona y personaliza la función"
               formControlName="interArrivalTimeSourceCkeck">
        <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
        <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
          <div *ngFor="let probFunc of listProbExpFunc; let i=index">
            <li ngbDropdownItem>
              <button class="btnElem" type="button" (click)="setInterArrivalTimeSourceCkeck(probFunc)">
                <div>
                  {{probFunc}}
                </div>
              </button>
            </li>
            <div *ngIf="i!=listProbExpFunc.length-1" class="dropdown-divider"></div>
          </div>
        </ul>
      </div>
      <div *ngIf="typeInterArrivalTime===2" ngbDropdown class="dropdown menuDropdown2 selectMenu imagesContainer">
        <input class="form-control" style="width: 20%" placeholder="Selecciona y personaliza la función"
               formControlName="interArrivalTimeSourceCkeck">
        <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
        <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
          <div *ngFor="let probFunc of listProbGeneralFunc; let i=index">
            <li ngbDropdownItem>
              <button class="btnElem" type="button" (click)="setInterArrivalTimeSourceCkeck(probFunc)">
                <div>
                  {{probFunc}}
                </div>
              </button>
            </li>
            <div *ngIf="i!=listProbGeneralFunc.length-1" class="dropdown-divider"></div>
          </div>
        </ul>
      </div>

      <div *ngIf="typeInterArrivalTime!==-1" class="imagesContainer">
        <span *ngIf="interArrivalTimeSourceCkeck && interArrivalTimeSourceCkeck.invalid" class="errorMessage">Debe estar seleccionada una opción y tener un formato correcto.</span>
      </div>

      <div class="titleHelpMenu">
        - Tiempo de servicio de servidores:
        <span class="asterisk">*</span>
      </div>
      <div class="containerHelpMenu" style="margin-bottom: 20px;">
        <div class="leftContainer">
          <div class="subTitleHelpMenu">
            Elige el tipo de tiempo que se tardan los productos en procesarse en los elementos.
          </div>
        </div>
        <div class="rightContainer">
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input class="form-control" placeholder="Selecciona el tipo de tiempo de servicio"
                   formControlName="serviceTimeType">
            <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
            <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
              <div *ngFor="let types of listInterArrivalTypes; let i=index">
                <li ngbDropdownItem>
                  <button class="btnElem" type="button" (click)="setServiceTimeType(i)">
                    <div>
                      {{types}}
                    </div>
                  </button>
                </li>
                <div *ngIf="i!=listInterArrivalTypes.length-1" class="dropdown-divider"></div>
              </div>
            </ul>
          </div>
        </div>
      </div>

      <div class="imagesContainer">
        <span *ngIf="serviceTimeType && serviceTimeType.invalid" class="errorMessage">Debe estar seleccionada una opción.</span>
      </div>

      <div *ngIf="typeServiceTime!==-1" class="imagesContainer" style="margin-bottom: 20px;">
        <div class="subTitleHelpMenu">
          Personaliza cada cuanto quieres que se procesen los productos
        </div>
      </div>
      <div *ngIf="typeServiceTime===0" ngbDropdown class="dropdown menuDropdown2 selectMenu imagesContainer">
        <input class="form-control" style="width: 20%" placeholder="Selecciona y personaliza el tiempo de servicio"
               formControlName="serviceTime">
        <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
        <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
          <div *ngFor="let probFunc of listProbDeterministicFunc; let i=index">
            <li ngbDropdownItem>
              <button class="btnElem" type="button" (click)="setServiceTime(probFunc)">
                <div>
                  {{probFunc}}
                </div>
              </button>
            </li>
            <div *ngIf="i!=listProbDeterministicFunc.length-1" class="dropdown-divider"></div>
          </div>
        </ul>
      </div>
      <div *ngIf="typeServiceTime===1" ngbDropdown class="dropdown menuDropdown2 selectMenu imagesContainer">
        <input class="form-control" style="width: 20%" placeholder="Selecciona y personaliza el tiempo de servicio"
               formControlName="serviceTime">
        <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
        <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
          <div *ngFor="let probFunc of listProbExpFunc; let i=index">
            <li ngbDropdownItem>
              <button class="btnElem" type="button" (click)="setServiceTime(probFunc)">
                <div>
                  {{probFunc}}
                </div>
              </button>
            </li>
            <div *ngIf="i!=listProbExpFunc.length-1" class="dropdown-divider"></div>
          </div>
        </ul>
      </div>
      <div *ngIf="typeServiceTime===2" ngbDropdown class="dropdown menuDropdown2 selectMenu imagesContainer">
        <input class="form-control" style="width: 20%" placeholder="Selecciona y personaliza el tiempo de servicio"
               formControlName="serviceTime">
        <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
        <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
          <div *ngFor="let probFunc of listProbGeneralFunc; let i=index">
            <li ngbDropdownItem>
              <button class="btnElem" type="button" (click)="setServiceTime(probFunc)">
                <div>
                  {{probFunc}}
                </div>
              </button>
            </li>
            <div *ngIf="i!=listProbGeneralFunc.length-1" class="dropdown-divider"></div>
          </div>
        </ul>
      </div>

      <div *ngIf="typeServiceTime!==-1" class="imagesContainer">
        <span *ngIf="serviceTime && serviceTime.invalid" class="errorMessage">Debe estar seleccionada una opción y tener un formato correcto.</span>
      </div>

      <div class="titleHelpMenu">
        - Número de servidores:
        <span class="asterisk">*</span>
      </div>
      <div class="containerHelpMenu" style="margin-bottom: 20px;">
        <div class="leftContainer">
          <div class="subTitleHelpMenu">
            Elige el número de servidores de la simulación.
          </div>
        </div>
        <div class="rightContainer">
          <input type="number" class="form-control" placeholder="Selecciona el número de servidores"
                 formControlName="numberOfServers">
        </div>
      </div>
      <div class="imagesContainer">
        <span *ngIf="numberOfServers && numberOfServers.invalid" class="errorMessage">Debe tener un valor mayor que 0 y menor que 5.</span>
      </div>

      <div class="titleHelpMenu">
        - Capacidad de las cola:
        <span class="asterisk">*</span>
      </div>
      <div class="containerHelpMenu" style="margin-bottom: 20px;">
        <div class="leftContainer">
          <div class="subTitleHelpMenu">
            Elige el número de productos que puede tener la cola de la simulación.
          </div>
        </div>
        <div class="rightContainer">
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input type="text" class="form-control customizeInput"
                   placeholder="Selecciona o introduce una cantidad" formControlName="capacityQueueCheck">
            <button ngbDropdownToggle class="btn ddbutton" type="button">
            </button>
            <ul ngbDropdownMenu class="dropdown-menu ">
              <li ngbDropdownItem>
                <button class="btnElem" type="button" (click)="setCapacityQueueCheck('Limitados')">
                  <div>
                    <i class="fa-solid fa-x"></i>Limitados
                  </div>
                </button>
              </li>
              <div class="dropdown-divider"></div>
              <li ngbDropdownItem>
                <button class="btnElem" type="button"
                        (click)="setCapacityQueueCheck('Ilimitados')">
                  <div>
                    <i class="fa-solid fa-infinity"></i>Ilimitados
                  </div>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="imagesContainer">
        <span *ngIf="capacityQueueCheck && capacityQueueCheck.invalid" class="errorMessage">Debe tener un valor entero o ser Ilimiados.</span>
      </div>

      <div class="titleHelpMenu">
        - Disciplina de la cola:
        <span class="asterisk">*</span>
      </div>
      <div class="containerHelpMenu" style="margin-bottom: 20px;">
        <div class="leftContainer">
          <div class="subTitleHelpMenu">
            Elige la disciplina de la cola.
          </div>
        </div>
        <div class="rightContainer">
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input type="text" class="form-control customizeInput"
                   placeholder="Selecciona una disciplina" formControlName="queueDisciplineCheck">
            <button ngbDropdownToggle class="btn ddbutton" type="button">
            </button>
            <ul ngbDropdownMenu class="dropdown-menu ">
              <li ngbDropdownItem>
                <button class="btnElem" type="button" (click)="setDisciplineQueueCheck('Fifo')">
                  <div>
                    Fifo (First In First Out)
                  </div>
                </button>
              </li>
              <div class="dropdown-divider"></div>
              <li ngbDropdownItem>
                <button class="btnElem" type="button" (click)="setDisciplineQueueCheck('Lifo')">
                  <div>
                    Lifo (Last In First Out)
                  </div>
                </button>
              </li>
              <div class="dropdown-divider"></div>
              <li ngbDropdownItem>
                <button class="btnElem" type="button" (click)="setDisciplineQueueCheck('Random')">
                  <div>
                    Random
                  </div>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="imagesContainer">
        <span *ngIf="queueDisciplineCheck && queueDisciplineCheck.invalid" class="errorMessage">Debe estar seleccionada una opción.</span>
      </div>

      <div *ngIf="!customTemplateForm.invalid" style="margin-top: 20px" class="titleHelpMenu imagesContainer">
        Sistema de colas elegido:
      </div>
      <div *ngIf="!customTemplateForm.invalid" class="titleHelpMenu imagesContainer"
           style="margin-top: 10px; font-size: 20px;">
        <span *ngIf="customTemplateForm.value.interArrivalTimeSourceType==='Determinista'">D/</span>
        <span *ngIf="customTemplateForm.value.interArrivalTimeSourceType==='Exponencial'">M/</span>
        <span *ngIf="customTemplateForm.value.interArrivalTimeSourceType==='General'">G/</span>
        <span *ngIf="customTemplateForm.value.serviceTimeType==='Determinista'">D/</span>
        <span *ngIf="customTemplateForm.value.serviceTimeType==='Exponencial'">M/</span>
        <span *ngIf="customTemplateForm.value.serviceTimeType==='General'">G/</span>
        <span>{{customTemplateForm.value.numberOfServers}}/</span>
        <span>{{customTemplateForm.value.capacityQueueCheck}}/</span>
        <span>{{customTemplateForm.value.queueDisciplineCheck}}</span>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cerrar</button>
      <button type="submit" class="btn btn-danger" [disabled]="customTemplateForm.invalid" (click)="[modal.dismiss()]">
        Confirmar
      </button>
    </div>
  </form>
</ng-template>

<ng-template #quickSimulation let-modal class="modal fade">
  <div class="modal-header">
    <h5 class="modal-title">Simulación rápida</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>

  </div>
  <form [formGroup]="quickSimulationForm" (ngSubmit)="quickSimulationFunc()">
    <div class="modal-body">
      <label for="timeSimulation" class="col-form-label">Tiempo de observación [minutos]<span
        class="asterisk">*</span></label>
      <input type="number" class="form-control" id="timeSimulation" formControlName="timeSimulation">
      <span *ngIf="timeSimulation && timeSimulation.invalid" class="errorMessage">Debe tener un valor entero mayor que 0 y menor que 180.</span>
      <div class="form-group mt-3">
        <label for="numberSimulations" class="col-form-label">Número de simulaciones<span
          class="asterisk">*</span></label>
        <input type="number" class="form-control" id="numberSimulations" formControlName="numberSimulations">
        <span *ngIf="numberSimulations && numberSimulations.invalid" class="errorMessage">Debe tener un valor entero entre 1 y 5.</span>
      </div>
      <div class="form-group mt-3">
        <label class="col-form-label">Formato de exportación de resultados<span
          class="asterisk">*</span></label>
        <div>
          <input class="checkboxInput" type="checkbox" id="pdf" name="pdf" value="pdf" formControlName="pdfFormat">
          <label class="checkboxLabel" for="pdf">PDF</label>
          <input class="checkboxInput" type="checkbox" id="csv" name="csv" value="csv" formControlName="csvFormat">
          <label for="csv">CSV</label>
        </div>
        <span *ngIf="quickSimulationForm.value.pdfFormat===false && quickSimulationForm.value.csvFormat===false"
              class="errorMessage">Se debe seleccionar al menos un formato.</span>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="modal.dismiss()">Cancelar</button>
      <button
        [disabled]="quickSimulationForm.invalid || (quickSimulationForm.value.pdfFormat===false && quickSimulationForm.value.csvFormat===false)"
        type="submit" class="btn btn-danger" (click)="modal.dismiss()">Simular
      </button>
    </div>
  </form>
</ng-template>

<ng-template #deleteItem let-modal class="modal fade">
  <div class="modal-header">
    <h5 *ngIf="itemContainerModal.item.description==='Source'" class="modal-title">Eliminar fuente</h5>
    <h5 *ngIf="itemContainerModal.item.description==='Sink'" class="modal-title">Eliminar desagüe</h5>
    <h5 *ngIf="itemContainerModal.item.description==='Queue'" class="modal-title">Eliminar cola</h5>
    <h5 *ngIf="itemContainerModal.item.description==='Server'" class="modal-title">Eliminar servidor</h5>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <p>¿Deseas borrar este item de todas formas?</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancelar</button>
    <button type="button" class="btn btn-danger" (click)="[modal.dismiss(),deleteItemFunction()]">Confirmar</button>
  </div>
</ng-template>

<ng-template class="modal fade" #editSource let-modal>
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Editar Fuente</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="[resetListNames(),modal.dismiss()]"></button>
    </div>
    <form [formGroup]="editSourceForm" (ngSubmit)="editItem()">
      <div class="modal-body">
        <label for="nameSource" class="col-form-label">Nombre<span
          class="asterisk">*</span></label>
        <input type="text" class="form-control" id="nameSource" formControlName="nameSource">
        <span *ngIf="nameSource && nameSource.invalid && !editSourceForm.controls.nameSource.hasError('invalidFormat')"
              class="errorMessage">Debe tener una longitud de entre 1 y 10 caracteres.</span>
        <span *ngIf="editSourceForm.controls.nameSource.hasError('invalidFormat')" class="errorMessage">Ya existe un item con este nombre.</span>
        <div class="form-group mt-3">

          <label for="interArrivalTime" class="col-form-label">Tiempo entre llegadas<span
            class="asterisk">*</span></label>
          <span class="tooltipContainer" placement="right" [ngbTooltip]="list" tooltipClass="probFuncTooltip">
            <i class="fa-solid fa-question"></i>
          </span>
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input class="form-control" id="interArrivalTime" formControlName="interArrivalTimeSource">
            <button class="btn ddbutton" type="button" ngbDropdownToggle></button>
            <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
              <div *ngFor="let probFunc of listProbFunc; let i=index">
                <li ngbDropdownItem>
                  <button class="btnElem" type="button" (click)="setinterArrivalTime(probFunc)">
                    <div>
                      {{probFunc}}
                    </div>
                  </button>
                </li>
                <div *ngIf="i!=listProbFunc.length-1" class="dropdown-divider"></div>
              </div>
            </ul>
          </div>
          <span *ngIf="editSourceForm.controls.interArrivalTimeSource.hasError('invalidFormat')" class="errorMessage">Error de formato.</span>
        </div>
        <div class="form-group mt-3">
          <label for="numberProducts" class="col-form-label">
            Número de productos<span class="asterisk">*</span>
          </label>
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input type="text" class="form-control customizeInput" id="numberProducts"
                   placeholder="Selecciona o introduce una cantidad" formControlName="numberProductsSource">
            <button class="btn ddbutton" type="button" ngbDropdownToggle>
            </button>
            <ul class="dropdown-menu" ngbDropdownMenu>
              <li ngbDropdownItem>
                <button class="btnElem" id="limitedSource" type="button" (click)="setNumberProducts('Limitados')">
                  <div>
                    <i class="fa-solid fa-x"></i>Limitados
                  </div>
                </button>
              </li>
              <div class="dropdown-divider"></div>
              <li ngbDropdownItem>
                <button class="btnElem" id="unlimitedSource" type="button" (click)="setNumberProducts('Ilimitados')">
                  <div>
                    <i class="fa-solid fa-infinity"></i>Ilimitados
                  </div>
                </button>
              </li>
            </ul>
          </div>
          <span *ngIf="numberProductsSource && numberProductsSource.invalid" class="errorMessage">Debe ser un número o ser Ilimitados</span>
        </div>
        <div class="form-group mt-3" *ngIf="numConnections>0">
          <label for="sendToStrategySource" class="col-form-label"></label>
          Enviar a <span class="asterisk">*</span>
          <div class="input-group mt-2">
            <span class="strategy">Estrategia:</span>
            <select id="sendToStrategySource" class="form-select strategySelect"
                    formControlName="sendToStrategySource">
              <option selected disabled value="">Selecciona una estrategia</option>
              <option [value]="strategy" *ngFor="let strategy of listSendToStrategiesSource">{{strategy}}</option>
            </select>
          </div>
          <div formGroupName="percentagesSource" class="connections">
            <div class="connectionsTitle">Conexiones:</div>
            <div class="interPercenteges" *ngFor="let connection of itemContainerModal.connections; let i= index;">
              <span class="strategy">{{connection.destinationItem.name}}: </span>
              <input *ngIf="showConnections" type="number" class="form-control inputPercentage" [formControlName]="i">
              <input *ngIf="!showConnections" type="number" class="form-control inputPercentage" placeholder="X"
                     disabled> <span *ngIf="showConnections"> %</span>
            </div>
            <span
              *ngIf="(percentagesSource && percentagesSource.invalid) || (sendToStrategySource && sendToStrategySource.invalid)"
              class="errorMessage">La suma total de todos los porcentajes debe ser 100%</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                (click)="[resetListNames(),modal.dismiss()]">Cancelar
        </button>
        <button [disabled]="editSourceForm.invalid" type="submit" class="btn btn-danger"
                (click)="[resetListNames(),modal.dismiss()]">
          Guardar
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template class="modal fade" #editQueue let-modal>
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Editar Cola</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="[resetListNames(),modal.dismiss()]"></button>
    </div>
    <form [formGroup]="editQueueForm" (ngSubmit)="editItem()">
      <div class="modal-body">
        <label for="nameQueue" class="col-form-label">Nombre<span
          class="asterisk">*</span></label>
        <input type="text" class="form-control" id="nameQueue" formControlName="nameQueue">
        <span *ngIf="nameQueue && nameQueue.invalid && !editQueueForm.controls.nameQueue.hasError('invalidFormat')"
              class="errorMessage">Debe tener una longitud de entre 1 y 10 caracteres.</span>
        <span *ngIf="editQueueForm.controls.nameQueue.hasError('invalidFormat')" class="errorMessage">Ya existe un item con este nombre.</span>
        <div class="form-group mt-3">
          <label for="capacityQueue" class="col-form-label">
            Capacidad<span class="asterisk">*</span>
          </label>
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input type="text" class="form-control customizeInput" id="capacityQueue"
                   placeholder="Selecciona o introduce una cantidad" formControlName="capacityQueue">
            <button ngbDropdownToggle class="btn ddbutton" type="button">
            </button>
            <ul ngbDropdownMenu class="dropdown-menu ">
              <li ngbDropdownItem>
                <button class="btnElem" id="limitedCapacityQueue" type="button" (click)="setCapacityQueue('Limitados')">
                  <div>
                    <i class="fa-solid fa-x"></i>Limitados
                  </div>
                </button>
              </li>
              <div class="dropdown-divider"></div>
              <li ngbDropdownItem>
                <button class="btnElem" id="unlimitedCapacityQueue" type="button"
                        (click)="setCapacityQueue('Ilimitados')">
                  <div>
                    <i class="fa-solid fa-infinity"></i>Ilimitados
                  </div>
                </button>
              </li>
            </ul>
          </div>
          <span *ngIf="capacityQueue && capacityQueue.invalid"
                class="errorMessage">Debe ser un número o ser Ilimitados.</span>
        </div>
        <div class="form-group mt-3">
          <label for="queueDiscipline" class="col-form-label">
            Disciplina de la cola<span class="asterisk">*</span>
          </label>
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input type="text" class="form-control customizeInput" id="queueDiscipline"
                   placeholder="Selecciona o introduce una disciplina" formControlName="queueDiscipline">
            <button ngbDropdownToggle class="btn ddbutton" type="button">
            </button>
            <ul ngbDropdownMenu class="dropdown-menu ">
              <li ngbDropdownItem>
                <button class="btnElem" id="fifoQueue" type="button" (click)="setQueueDiscipline('Fifo')">
                  <div>
                    Fifo (First In First Out)
                  </div>
                </button>
              </li>
              <div class="dropdown-divider"></div>
              <li ngbDropdownItem>
                <button class="btnElem" id="lifoQueue" type="button" (click)="setQueueDiscipline('Lifo')">
                  <div>
                    Lifo (Last In First Out)
                  </div>
                </button>
              </li>
              <div class="dropdown-divider"></div>
              <li ngbDropdownItem>
                <button class="btnElem" id="randomQueue" type="button" (click)="setQueueDiscipline('Random')">
                  <div>
                    Random
                  </div>
                </button>
              </li>
            </ul>
          </div>
          <span *ngIf="queueDiscipline && queueDiscipline.invalid"
                class="errorMessage">Debe ser Fifo, Lifo o Random.</span>
        </div>
        <div class="form-group mt-3" *ngIf="numConnections>0">
          <label for="sendToStrategyQueue" class="col-form-label"></label>
          Enviar a <span class="asterisk">*</span>
          <div class="input-group mt-2">
            <span class="strategy">Estrategia:</span>
            <select id="sendToStrategyQueue" class="form-select strategySelect"
                    formControlName="sendToStrategyQueue">
              <option selected disabled value="">Selecciona una estrategia</option>
              <option [value]="strategy" *ngFor="let strategy of listSendToStrategiesQueue">{{strategy}}</option>
            </select>
          </div>
          <div formGroupName="percentagesQueue" class="connections">
            <div class="connectionsTitle">Conexiones:</div>
            <div class="interPercenteges" *ngFor="let connection of itemContainerModal.connections; let i= index;">
              <span class="strategy">{{connection.destinationItem.name}}: </span>
              <input *ngIf="showConnections" type="number" class="form-control inputPercentage" [formControlName]="i">
              <input *ngIf="!showConnections" type="number" class="form-control inputPercentage" placeholder="X"
                     disabled> <span *ngIf="showConnections"> %</span>
            </div>
            <span
              *ngIf="(percentagesQueue && percentagesQueue.invalid) || (sendToStrategyQueue && sendToStrategyQueue.invalid)"
              class="errorMessage">La suma total de todos los porcentajes debe ser 100%</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                (click)="[resetListNames(),modal.dismiss()]">Cancelar
        </button>
        <button [disabled]="editQueueForm.invalid" type="submit" class="btn btn-danger"
                (click)="[resetListNames(),modal.dismiss()]">Guardar
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #list>
  <div class="d-flex flex-column">
    <span class="titleTooltip">Guía de funciones de probabilidad:</span>
    <div *ngFor="let probFuncGuide of listProbFuncGuide">
      -{{probFuncGuide}}
    </div>

  </div>
</ng-template>

<ng-template class="modal fade" #editServer let-modal>
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Editar Servidor</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="[resetListNames(),modal.dismiss()]"></button>
    </div>
    <form [formGroup]="editServerForm" (ngSubmit)="editItem()">
      <div class="modal-body">
        <label for="nameProcesador" class="col-form-label">Nombre<span
          class="asterisk">*</span></label>
        <input type="text" class="form-control" id="nameProcesador" formControlName="nameServer">
        <span *ngIf="nameServer && nameServer.invalid && !editServerForm.controls.nameServer.hasError('invalidFormat')"
              class="errorMessage">Debe tener una longitud de entre 1 y 10 caracteres.</span>
        <span *ngIf="editServerForm.controls.nameServer.hasError('invalidFormat')" class="errorMessage">Ya existe un item con este nombre.</span>
        <div class="form-group mt-3">
          <label for="setUpTimeServer" class="col-form-label">Tiempo de establecimiento<span
            class="asterisk">*</span></label>
          <input type="number" class="form-control" id="setUpTimeServer" formControlName="setUpTimeServer">
          <span *ngIf="setUpTimeServer && setUpTimeServer.invalid"
                class="errorMessage">Debe tener un valor entero.</span>

        </div>
        <div class="form-group mt-3 ">
          <label for="cycletimeServer" class="col-form-label">
            Duración del ciclo<span class="asterisk">*</span>
          </label>
          <span class="tooltipContainer" placement="right" [ngbTooltip]="list" tooltipClass="probFuncTooltip">
            <i class="fa-solid fa-question"></i>
          </span>
          <div ngbDropdown class="dropdown menuDropdown selectMenu">
            <input type="text" class="form-control customizeInput" id="cycletimeServer"
                   placeholder="Selecciona o introduce una distribución del ciclo" formControlName="cycletimeServer">
            <button class="btn ddbutton" type="button" ngbDropdownToggle>
            </button>
            <ul ngbDropdownMenu class="dropdown-menu pre-scrollable">
              <div *ngFor="let probFunc of listProbFunc; let i=index">
                <li ngbDropdownItem>
                  <button class="btnElem" type="button" (click)="setcycletimeServer(probFunc)">
                    <div>
                      {{probFunc}}
                    </div>
                  </button>
                </li>
                <div *ngIf="i!=listProbFunc.length-1" class="dropdown-divider"></div>
              </div>
            </ul>
          </div>
          <span *ngIf="editServerForm.controls.cycletimeServer.hasError('invalidFormat')"
                class="errorMessage">Error de formato.</span>
        </div>
        <div class="form-group mt-3" *ngIf="numConnections>0">
          <label for="sendToStrategyServer" class="col-form-label"></label>
          Enviar a <span class="asterisk">*</span>
          <div class="input-group mt-2">
            <span class="strategy">Estrategia:</span>
            <select id="sendToStrategyServer" class="form-select strategySelect"
                    formControlName="sendToStrategyServer">
              <option selected disabled value="">Selecciona una estrategia</option>
              <option [value]="strategy" *ngFor="let strategy of listSendToStrategiesServer">{{strategy}}</option>
            </select>
          </div>
          <div formGroupName="percentagesServer" class="connections">
            <div class="connectionsTitle">Conexiones:</div>
            <div class="interPercenteges" *ngFor="let connection of itemContainerModal.connections; let i= index;">
              <span class="strategy">{{connection.destinationItem.name}}: </span>
              <input *ngIf="showConnections" type="number" class="form-control inputPercentage" [formControlName]="i">
              <input *ngIf="!showConnections" type="number" class="form-control inputPercentage" placeholder="X"
                     disabled> <span *ngIf="showConnections"> %</span>
            </div>
            <span
              *ngIf="(percentagesServer && percentagesServer.invalid) || (sendToStrategyServer && sendToStrategyServer.invalid)"
              class="errorMessage">La suma total de todos los porcentajes debe ser 100%</span>
          </div>
        </div>
      </div>
      <div class="modal-footer mt-3">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                (click)="[resetListNames(),modal.dismiss()]">Cancelar
        </button>
        <button [disabled]="editServerForm.invalid" type="submit" class="btn btn-danger"
                (click)="[resetListNames(),modal.dismiss()]">Guardar
        </button>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #editSink let-modal class="modal fade">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title">Editar Sumidero</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="[resetListNames(),modal.dismiss()]"></button>
    </div>
    <form [formGroup]="editSinkForm" (ngSubmit)="editItem()">
      <div class="modal-body">
        <label for="nameSink" class="col-form-label">Nombre<span
          class="asterisk">*</span></label>
        <input type="text" class="form-control" id="nameSink" formControlName="nameSink">
        <span *ngIf="nameSink && nameSink.invalid && !editSinkForm.controls.nameSink.hasError('invalidFormat')"
              class="errorMessage">Debe tener una longitud de entre 1 y 10 caracteres.</span>
        <span *ngIf="editSinkForm.controls.nameSink.hasError('invalidFormat')" class="errorMessage">Ya existe un item con este nombre.</span>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal"
                (click)="[resetListNames(),modal.dismiss()]">Cancelar
        </button>
        <button [disabled]="editSinkForm.invalid" type="submit" class="btn btn-danger"
                (click)="[resetListNames(),modal.dismiss()]">Guardar
        </button>
      </div>
    </form>
  </div>
</ng-template>
